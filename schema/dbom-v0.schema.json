{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://quietwire.ai/dbom/v0/schema",
  "title": "DBoM v0 Attestation",
  "type": "object",
  "required": ["type", "subject", "provenance"],
  "additionalProperties": false,
  "properties": {
    "type": { "const": "attestation" },
    "subject": {
      "type": "object",
      "required": ["artifact"],
      "additionalProperties": false,
      "properties": { "artifact": { "$ref": "#/$defs/artifact" } }
    },
    "claims": { "type": "array", "items": { "$ref": "#/$defs/claim" } },
    "events": { "type": "array", "items": { "$ref": "#/$defs/event" } },
    "evidence": { "type": "array", "items": { "$ref": "#/$defs/evidence" } },
    "provenance": { "$ref": "#/$defs/provenance" }
  },
  "$defs": {
    "artifact": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "purl": { "type": "string" },
        "digest": {
          "type": "object",
          "patternProperties": {
            "^sha(256|384|512)$": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "anyOf": [ { "required": ["purl"] }, { "required": ["digest"] } ]
    },
    "claim": {
      "type": "object",
      "required": ["predicate"],
      "additionalProperties": true,
      "properties": {
        "predicate": { "type": "string" },
        "object": { "type": ["object", "string"] },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "label": { "enum": ["Observed", "Measured", "Reported", "Inferred"] }
      }
    },
    "event": {
      "type": "object",
      "required": ["type", "time"],
      "additionalProperties": true,
      "properties": {
        "type": { "type": "string" },
        "time": { "type": "string", "format": "date-time" },
        "valid_from": { "type": "string", "format": "date-time" },
        "valid_to": { "type": "string", "format": "date-time" }
      }
    },
    "evidence": {
      "type": "object",
      "required": ["source", "time"],
      "additionalProperties": true,
      "properties": {
        "source": { "type": "string" },
        "time": { "type": "string", "format": "date-time" },
        "method": { "type": "string" },
        "reviewer": { "type": "string" },
        "uncertainty": { "type": "number", "minimum": 0 }
      }
    },
    "provenance": {
      "type": "object",
      "required": ["issuer", "issued"],
      "additionalProperties": true,
      "properties": {
        "issuer": { "type": "string" },
        "issued": { "type": "string", "format": "date-time" }
      }
    }
  }
}
